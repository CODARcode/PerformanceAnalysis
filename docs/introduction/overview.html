

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Overview &mdash; Performance Analysis 3.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Installation" href="install.html" />
    <link rel="prev" title="Chimbuko: Performance Analysis" href="../index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Performance Analysis
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Introduction</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="#on-node-ad-module">On-node AD Module</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#parser">Parser</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pre-processing">Pre-processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#update-local-parameters">Update local parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="#anomaly-detection">Anomaly Detection</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#statistical-anomaly-analysis">Statistical anomaly analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="#advanced-anomaly-analysis">Advanced anomaly analysis</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#stream-local-viz-data">Stream local viz data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#post-processing">Post-processing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#parameter-server">Parameter Server</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#simple-parameter-server">Simple Parameter Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="#scalable-parameter-server">Scalable Parameter Server</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#provenance-database">Provenance Database</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#function-event-schema">Function event schema</a></li>
<li class="toctree-l2"><a class="reference internal" href="#metadata-schema">Metadata schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
</ul>
<p class="caption"><span class="caption-text">API For Developers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/api.html">Full API Listing</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Performance Analysis</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Overview</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/introduction/overview.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="overview">
<h1>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h1>
<p>The anomaly detection (ADM) module consists of three components: <strong>on-node anomaly detection (AD)</strong>,
<strong>parameter server (PS)</strong> and <strong>provenance database (ProvDB)</strong>.</p>
<div class="figure align-center" id="id1">
<a class="reference internal image-reference" href="../_images/ad.png"><img alt="Anomaly detection module architecture" src="../_images/ad.png" style="width: 1220.0px; height: 319.0px;" /></a>
<p class="caption"><span class="caption-text">Anomaly detection (AD) module: on-node AD module and paramter server (PS).</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</div>
<p>As described by the diagram above, an instrumented application communicates trace information to an instance of the AD, whose role it is to decide whether a function execution was anomalous. The decision is based upon globally aggregated function statistics that are collected on the PS and kept in sync with the AD instances. The PS also fulfils the role of collecting global statistics (number of anomalies, various counters) to forward to the external visualization module.</p>
<p>Detailed information about each anomaly is collected by the AD instances and forwarded to the ProvDB, which can be queried both online and offline to obtain more information.</p>
</div>
<div class="section" id="on-node-ad-module">
<h1>On-node AD Module<a class="headerlink" href="#on-node-ad-module" title="Permalink to this headline">¶</a></h1>
<p>The on-node anomaly detection (AD) module (per applications’ process) takes streamed trace data.
Each AD parses the streamed trace data and maintains a function call stack along with
any communication events (if available). Then, it determines anomalous function calls that have
extraordinary behaviors. If there are any anomalies within the current trace data,
the AD module stores them in files or DB. This is where significant data reduction occurs
because we only save the anomalies and a few nearby normal function calls of the anomalies.</p>
<div class="section" id="parser">
<h2>Parser<a class="headerlink" href="#parser" title="Permalink to this headline">¶</a></h2>
<p>Currently, the trace data is streamed via <a class="reference external" href="https://github.com/ornladios/ADIOS2">ADIOS2</a>.
We provide class <a class="reference external" href="../api/api_code.html#adparser">ADParser</a> to connect to an ADIOS2 writer side and
fetch necessary data for the performance analysis.</p>
</div>
<div class="section" id="pre-processing">
<h2>Pre-processing<a class="headerlink" href="#pre-processing" title="Permalink to this headline">¶</a></h2>
<p>In the pre-processing step, the <strong>on-node AD moudle</strong> maintains a call stack tree in application,
rank and thread levels (See class <a class="reference external" href="../api/api_code.html#adevent">ADEvent</a>). While it is building and
maintaining the call stack tree, it computes inclusive and exclusive running time for each function, and
mapping communication events to a function event.</p>
</div>
<div class="section" id="update-local-parameters">
<h2>Update local parameters<a class="headerlink" href="#update-local-parameters" title="Permalink to this headline">¶</a></h2>
<p>Using the pre-processed data, it first computes local parameters (depends on anomaly detection algorithm).
Then, the local parameters are updated via the Parameter Server to have robust and consistent
anomaly detection capabilities over the distribued <strong>on-node AD modules</strong>.
(See <a class="reference external" href="../api/api_code.html#adoutlier">ADOutlier</a>).</p>
</div>
<div class="section" id="anomaly-detection">
<h2>Anomaly Detection<a class="headerlink" href="#anomaly-detection" title="Permalink to this headline">¶</a></h2>
<p>With updated anomaly detection parameters, it determines anomaly functions calls.
(See <a class="reference external" href="../api/api_code.html#adoutlier">ADOutlier</a>)</p>
<div class="section" id="statistical-anomaly-analysis">
<h3>Statistical anomaly analysis<a class="headerlink" href="#statistical-anomaly-analysis" title="Permalink to this headline">¶</a></h3>
<p>An anomaly function call is a function call that has a longer (or shorter) execution time than
a upper (or a lower) threshold.</p>
<div class="math notranslate nohighlight">
\[\begin{split}threshold_{upper} = \mu_{i} + \alpha * \sigma_{i} \\
threshold_{lower} = \mu_{i} - \alpha * \sigma_{i}\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(\mu_{i}\)</span> and <span class="math notranslate nohighlight">\(\sigma_{i}\)</span> are mean and standard deviation of execution time
of a function <span class="math notranslate nohighlight">\(i\)</span>, respectively, and <span class="math notranslate nohighlight">\(\alpha\)</span> is a control parameter (the lesser value,
the more anomalies or the more false positives).</p>
<p>(See <a class="reference external" href="../api/api_code.html#adoutlier">ADOutlier</a> and <a class="reference external" href="../api/api_code.html#runstats">RunStats</a>).</p>
</div>
<div class="section" id="advanced-anomaly-analysis">
<h3>Advanced anomaly analysis<a class="headerlink" href="#advanced-anomaly-analysis" title="Permalink to this headline">¶</a></h3>
<p>TBD</p>
</div>
</div>
<div class="section" id="stream-local-viz-data">
<h2>Stream local viz data<a class="headerlink" href="#stream-local-viz-data" title="Permalink to this headline">¶</a></h2>
<p>Once anmalies are identified, statistics related those anomalies (e.g. mean and standard deviation
of the number of anomalies per rank) is sent to the Parameter Server. Then the Parameter Server will
stream the aggregated statistics to the Visualization Server so that users can evaluate the overall performance
of the running applications in real time.
(See <a class="reference external" href="../api/api_code.html#adoutlier">ADOutlier</a>).</p>
</div>
<div class="section" id="post-processing">
<h2>Post-processing<a class="headerlink" href="#post-processing" title="Permalink to this headline">¶</a></h2>
<p>Currently, in the post-processing step, the evaluated function calls are trimed out from
the call stack tree (See <a class="reference external" href="../api/api_code.html#adevent">ADEvent</a>) and the trimed function calls
are sent to the visualization server or stored in the database according to users’ configuration
(See <a class="reference external" href="../api/api_code.html#adio">ADio</a>)</p>
</div>
</div>
<div class="section" id="parameter-server">
<h1>Parameter Server<a class="headerlink" href="#parameter-server" title="Permalink to this headline">¶</a></h1>
<p>The parameter server (PS) provides two services:</p>
<ul class="simple">
<li><p>Maintain global parameters to provide consistent and robust anomaly detection power over on-node AD modules</p></li>
<li><p>Keep a global view of workflow-level performance trace analysis results and stream to visualization server</p></li>
</ul>
<div class="section" id="simple-parameter-server">
<h2>Simple Parameter Server<a class="headerlink" href="#simple-parameter-server" title="Permalink to this headline">¶</a></h2>
<div class="figure align-center" id="id2">
<a class="reference internal image-reference" href="../_images/ps.png"><img alt="Simple parameter server architecture" src="../_images/ps.png" style="width: 470.0px; height: 462.0px;" /></a>
<p class="caption"><span class="caption-text">Simple parameter server architecture</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</div>
<p>(<strong>C</strong>)lients (i.e. on-node AD modules) send requests with thier local parameters to be updated
and to get global parameters. The requests goes to the <strong>Frontend</strong> router and distributed thread (<strong>W</strong>)orkers
via the <strong>Backend</strong> router in round-robin fashion. For the task of updating parameters, workers first
acquire a global lock, and update the <strong>in-mem DB</strong>, and return the latest parameters at the momemnt.
Similrary, for the task of streaming global anomaly statistics, it will stored in a queue and the (<strong>S</strong>)treaming thread,
which is dedicated to stream the anomaly statistics to a visualization server periodically.</p>
<ul class="simple">
<li><p>For network layer, see <a class="reference internal" href="../api/api_code.html#zmqnet"><span class="std std-ref">ZMQNet</span></a></p></li>
<li><p>For in-Mem DB, see <a class="reference internal" href="../api/api_code.html#sstdparam"><span class="std std-ref">SstdParam</span></a></p></li>
</ul>
<p>This simple parameter server becomes a bottleneck as the number of requests (or clients) are increasing.
In the following subsection, we will describe the scalable parameter server.</p>
</div>
<div class="section" id="scalable-parameter-server">
<h2>Scalable Parameter Server<a class="headerlink" href="#scalable-parameter-server" title="Permalink to this headline">¶</a></h2>
<p>TBD</p>
</div>
</div>
<div class="section" id="provenance-database">
<h1>Provenance Database<a class="headerlink" href="#provenance-database" title="Permalink to this headline">¶</a></h1>
<p>The role of the provenance database is to store detailed information about anomalous events. For comparison, samples of normal executions are also stored. Additionally, a wealth of metadata regarding the characteristics of the devices upon which the application is runnig are stored within.</p>
<p>The database is implemented using <a class="reference external" href="https://xgitlab.cels.anl.gov/sds/sonata">Sonata</a> which implements a remote database built on top of <a class="reference external" href="https://unqlite.org/">UnQLite</a>, a server-less JSON document store database. Sonata is capable of furnishing many clients and allows for arbitrarily complex document retrieval via <a class="reference external" href="https://unqlite.org/jx9.html">jx9 queries</a>.</p>
<p>The database is organized into three <em>collections</em>:</p>
<ul class="simple">
<li><p><strong>anomalies</strong> : the anomalous function executions</p></li>
<li><p><strong>normalexecs</strong> : the samples of normal function executions</p></li>
<li><p><strong>metadata</strong> : the metadata describing the machine/devices</p></li>
</ul>
<p>Below we describe the JSON schema for the <strong>anomalies</strong> and <strong>normalexecs</strong> collections.</p>
<div class="section" id="function-event-schema">
<h2>Function event schema<a class="headerlink" href="#function-event-schema" title="Permalink to this headline">¶</a></h2>
<p>This section describes the JSON schema for the <strong>anomalies</strong> and <strong>normalexecs</strong> collections. The fields of the JSON object are bolded, and a brief description follows the colon (:).</p>
<hr class="docutils" />
<div class="line-block">
<div class="line">{</div>
<div class="line-block">
<div class="line"><strong>“__id”</strong>: <em>Record index assigned by Sonata</em>,</div>
<div class="line"><strong>“call_stack”</strong>:    <em>Function call stack</em>,</div>
<div class="line">[</div>
<div class="line-block">
<div class="line">{</div>
<div class="line-block">
<div class="line"><strong>“entry_time”</strong>: <em>timestamp of function entry</em> ,</div>
<div class="line"><strong>“fid”</strong>: <em>Global function index (can be used as a key instead of function name)</em>,</div>
<div class="line"><strong>“func”</strong>: <em>function name</em></div>
</div>
<div class="line">},</div>
<div class="line">….</div>
</div>
<div class="line">],</div>
<div class="line"><strong>“counter_events”</strong>: [  <em>An array of counter data received on the specific process thread during function execution</em></div>
<div class="line-block">
<div class="line">{</div>
<div class="line-block">
<div class="line"><strong>“counter_idx”</strong>: <em>An index used internally to index counters</em>,</div>
<div class="line"><strong>“counter_name”</strong>: <em>A string describing the counter</em>,</div>
<div class="line"><strong>“counter_value”</strong>: <em>The value of the counter (integer)</em>,</div>
<div class="line"><strong>“pid”</strong>: <em>process index</em>,</div>
<div class="line"><strong>“rid”</strong>: <em>process rank</em>,</div>
<div class="line"><strong>“tid”</strong>: <em>process thread</em>,</div>
<div class="line"><strong>“ts”</strong>: <em>timestamp</em></div>
</div>
<div class="line">},</div>
<div class="line">…</div>
</div>
<div class="line">],</div>
<div class="line"><strong>“entry”</strong>: <em>Timestamp of function entry</em>,</div>
<div class="line"><strong>“exit”</strong>: <em>Timestamp of function exit</em>,</div>
<div class="line"><strong>“event_id”</strong>: <em>A unique string of format “&lt;PROCESS:RANK:INDEX&gt;” associated with the event</em>,</div>
<div class="line"><strong>“fid”</strong>: <em>Global function index (can be used as a key instead of function name)</em>,</div>
<div class="line"><strong>“func”</strong>: <em>function name</em>,</div>
<div class="line"><strong>“func_stats”</strong>:   <em>Statistics of function execution time</em></div>
<div class="line">{</div>
<div class="line-block">
<div class="line"><strong>“accumulate”</strong>: <em>not used at present</em>,</div>
<div class="line"><strong>“count”</strong>: <em>number of times function encountered (global)</em>,</div>
<div class="line"><strong>“kurtosis”</strong>: <em>kurtosis of distribution</em>,</div>
<div class="line"><strong>“maximum”</strong>: <em>maximum of distribution</em>,</div>
<div class="line"><strong>“mean”</strong>: <em>mean of distribution</em>,</div>
<div class="line"><strong>“minimum”</strong>: <em>minimum of distribution</em>,</div>
<div class="line"><strong>“skewness”</strong>: <em>skewness of distribution</em>,</div>
<div class="line"><strong>“stddev”</strong>: <em>standard deviation of distribution</em></div>
</div>
<div class="line">},</div>
<div class="line"><strong>“is_gpu_event”</strong>: <em>true or false depending on whether function executed on a GPU</em></div>
<div class="line"><strong>“gpu_location”</strong>: <em>if a GPU event, a JSON description of the context (see below), otherwise null</em>,</div>
<div class="line"><strong>“gpu_parent”</strong>: <em>if a GPU event, a JSON description of the parent CPU function (see below), otherwise null</em>,</div>
<div class="line"><strong>“pid”</strong>: <em>process index</em>,</div>
<div class="line"><strong>“rid”</strong>: <em>process rank</em>,</div>
<div class="line"><strong>“tid”</strong>: <em>thread index</em></div>
<div class="line"><strong>“runtime_exclusive”</strong>: <em>Function runtime exclusive of children</em>,</div>
<div class="line"><strong>“runtime_total”</strong>: <em>Function total runtime</em>,</div>
</div>
<div class="line">}</div>
</div>
<hr class="docutils" />
<p>The schema for the <strong>gpu_location</strong> field is as follows:</p>
<hr class="docutils" />
<div class="line-block">
<div class="line">{</div>
<div class="line-block">
<div class="line"><strong>“context”</strong>: <em>GPU device context (NVidia terminology)</em>,</div>
<div class="line"><strong>“device”</strong>: <em>GPU device index</em>,</div>
<div class="line"><strong>“stream”</strong>: <em>GPU device stream (NVidia terminology)</em>,</div>
<div class="line"><strong>“thread”</strong>: <em>virtual thread index assigned to this context/device/stream by Tau</em></div>
</div>
<div class="line">}</div>
</div>
<hr class="docutils" />
<p>and for the <strong>gpu_parent</strong> field:</p>
<hr class="docutils" />
<div class="line-block">
<div class="line">{</div>
<div class="line-block">
<div class="line"><strong>“event_id”</strong>: <em>The event index string (format “&lt;PROCESS:RANK:INDEX&gt;”) describing the parent function execution</em>,</div>
<div class="line"><strong>“tid”</strong>: <em>Thread index for CPU parent function</em>,</div>
<div class="line"><strong>“call_stack”</strong>:    <em>Parent function call stack</em>,</div>
<div class="line">[</div>
<div class="line-block">
<div class="line">{</div>
<div class="line-block">
<div class="line"><strong>“entry_time”</strong>: <em>timestamp of function entry</em> ,</div>
<div class="line"><strong>“fid”</strong>: <em>Global function index (can be used as a key instead of function name)</em>,</div>
<div class="line"><strong>“func”</strong>: <em>function name</em></div>
</div>
<div class="line">},</div>
<div class="line">….</div>
</div>
<div class="line">]</div>
</div>
<div class="line">}</div>
</div>
<hr class="docutils" />
<p>Note that Tau considers a GPU device/context/stream much in the same way as a CPU thread, and assigns it a unique index. This index is the “thread index” for GPU events.</p>
</div>
<div class="section" id="metadata-schema">
<h2>Metadata schema<a class="headerlink" href="#metadata-schema" title="Permalink to this headline">¶</a></h2>
<p>Metadata are stored in the metadata collection in the following JSON schema:</p>
<hr class="docutils" />
<div class="line-block">
<div class="line">{</div>
<div class="line-block">
<div class="line"><strong>“descr”</strong>: <em>String description (key) of metadata entry</em></div>
<div class="line"><strong>“rid”</strong>: <em>Process rank from which metadata originated</em>,</div>
<div class="line"><strong>“tid”</strong>: <em>Process thread associated with metadata</em>,</div>
<div class="line"><strong>“value”</strong>: <em>Value of the metadata entry</em>,</div>
<div class="line"><strong>“__id”</strong>: <em>Record index assigned by Sonata*</em></div>
</div>
<div class="line">}</div>
</div>
<p>Note that the <strong>tid</strong> (thread index) for metadata is usually 0, apart from for metadata associated with a GPU context/device/stream, for which the index is the virtual thread index assigned by Tau to the context/device/stream.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="install.html" class="btn btn-neutral float-right" title="Installation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../index.html" class="btn btn-neutral float-left" title="Chimbuko: Performance Analysis" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Brookhaven National Laboratory

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>